
\documentclass[a4paper,twoside,12pt]{book}
\usepackage[utf8]{inputenc}                                      
\usepackage[T1]{fontenc}  
\usepackage{amsmath,amsfonts,amssymb,amsthm}
\usepackage[british,polish]{babel} 
\usepackage{indentfirst}
\usepackage{lmodern}
\usepackage{graphicx} 
\usepackage{hyperref}
\usepackage{booktabs}
%\usepackage{tikz}
%\usepackage{pgfplots}
\usepackage{mathtools}
\usepackage{geometry}
\usepackage{float}
\usepackage{afterpage}
\usepackage{placeins}
\usepackage[page]{appendix} % toc,
\renewcommand{\appendixtocname}{Dodatki}
\renewcommand{\appendixpagename}{Dodatki}
\renewcommand{\appendixname}{Dodatek}

\usepackage{setspace}
\onehalfspacing


\frenchspacing

\usepackage{listings}
%\lstset{
%	language={},
%	basicstyle=\ttfamily,
%	keywordstyle=\lst@ifdisplaystyle\color{blue}\fi,
%	commentstyle=\color{gray}
%}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
% listingi 
\usepackage{listings}
\lstset{%
language=C++,%
commentstyle=\textit,%
identifierstyle=\textsf,%
keywordstyle=\sffamily\bfseries, %\texttt, %
%captionpos=b,%
tabsize=3,%
frame=lines,%
numbers=left,%
numberstyle=\tiny,%
numbersep=5pt,%
breaklines=true,%
morekeywords={descriptor_gaussian,descriptor,partition,fcm_possibilistic,dataset,my_exception,exception,std,vector},%
escapeinside={@*}{*@},%
%texcl=true, % wylacza tryb verbatim w komentarzach jednolinijkowych
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%

%%%% TODO LIST GENERATOR %%%%%%%%%

%\usepackage{tikz}
%\usepackage{manfnt}   % dangerous sign 
\usepackage{color}
\definecolor{brickred}      {cmyk}{0   , 0.89, 0.94, 0.28}

\makeatletter \newcommand \kslistofremarks{\section*{Uwagi} \@starttoc{rks}}
  \newcommand\l@uwagas[2]
    {\par\noindent \textbf{#2:} %\parbox{10cm}
{#1}\par} \makeatother


\newcommand{\ksremark}[1]{%
{%\marginpar{\textdbend}
{\color{brickred}{[#1]}}}%
\addcontentsline{rks}{uwagas}{\protect{#1}}%
}

\newcommand{\comma}{\ksremark{przecinek}}
\newcommand{\nocomma}{\ksremark{bez przecinka}}
\newcommand{\styl}{\ksremark{styl}}
\newcommand{\ortografia}{\ksremark{ortografia}}
\newcommand{\fleksja}{\ksremark{fleksja}}
\newcommand{\pauza}{\ksremark{pauza `--', nie dywiz `-'}}
\newcommand{\kolokwializm}{\ksremark{kolokwializm}}

%%%%%%%%%%%%%% END OF TODO LIST GENERATOR %%%%%%%%%%%

%%%%%%%%%%%% ZYWA PAGINA %%%%%%%%%%%%%%%
% brak kapitalizacji zywej paginy
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LO]{\nouppercase{\it\rightmark}}
\fancyhead[RE]{\nouppercase{\it\leftmark}}
\fancyhead[LE,RO]{\it\thepage}


\fancypagestyle{tylkoNumeryStron}{%
   \fancyhf{} 
   \fancyhead[LE,RO]{\it\thepage}
}

\fancypagestyle{NumeryStronNazwyRozdzialow}{%
   \fancyhf{} 
   \fancyhead[LO]{\nouppercase{\it\rightmark}}
   \fancyhead[RE]{\nouppercase{\it\leftmark}}
   \fancyhead[LE,RO]{\it\thepage}
}


%%%%%%%%%%%%% OBCE WTRETY  
\newcommand{\obcy}[1]{\emph{#1}}
\newcommand{\ang}[1]{{\selectlanguage{british}\obcy{#1}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% polskie oznaczenia funkcji matematycznych
\renewcommand{\tan}{\operatorname {tg}}
\renewcommand{\log}{\operatorname {lg}}

% jeszcze jakies drobiazgi

\newcounter{stronyPozaNumeracja}

\newcommand{\hcancel}[1]{%
    \tikz[baseline=(tocancel.base)]{
        \node[inner sep=0pt,outer sep=0pt] (tocancel) {#1};
        \draw[red] (tocancel.south west) -- (tocancel.north east);
    }%
}%

\newcommand{\miesiac}{%
  \ifcase\the\month
  \or styczeń% 1
  \or luty% 2
  \or marzec% 3
  \or kwiecień% 4
  \or maj% 5
  \or czerwiec% 6
  \or lipiec% 7
  \or sierpień% 8
  \or wrzesień% 9
  \or październik% 10
  \or listopad% 11
  \or grudzień% 12
  \fi}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Helvetica font macros for the title page:
\newcommand{\headerfont}{\fontfamily{phv}\fontsize{18}{18}\bfseries\scshape\selectfont}
\newcommand{\titlefont}{\fontfamily{phv}\fontsize{18}{18}\selectfont}
\newcommand{\otherfont}{\fontfamily{phv}\fontsize{14}{14}\selectfont}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newcommand{\autor}{Seweryn Gładysz}
\newcommand{\promotor}{dr inż. Ewa Płuciennik}
\newcommand{\konsultant}{dr inż. Imię Nazwisko}
\newcommand{\tytul}{System zarządzania siecią siłowni oparty o bazę dokumentową}
\newcommand{\polsl}{Politechnika Śląska}
\newcommand{\wydzial}{Wydział Automatyki, Elektroniki i Informatyki}
\newcommand{\kierunek}{Kierunek: Informatyka}


\begin{document}
%\kslistofremarks 
	
%%%%%%%%%%%%%%%%%%  STRONA TYTULOWA %%%%%%%%%%%%%%%%%%%
\pagestyle{empty}
{
	\newgeometry{top=2.5cm,%
	             bottom=2.5cm,%
	             left=3cm,
	             right=2.5cm}
	\sffamily
	\rule{0cm}{0cm}
	
	\begin{center}
	\includegraphics[width=29mm]{logo_pl.jpg}
	\end{center} 
	\vspace{1cm}
	\begin{center}
	\headerfont \polsl
	\end{center}
	\begin{center}
	\headerfont \wydzial
	\end{center}
	\begin{center}
	\headerfont \kierunek
	\end{center}
	\vfill
	\begin{center}
	\titlefont Praca dyplomowa inżynierska
	\end{center}
	\vfill
	
	\begin{center}
	\otherfont \tytul\par
	\end{center}
	
	\vfill
	
	\vfill
	 
	\noindent\vbox
	{
		\hbox{\otherfont autor: \autor}
		\vspace{12pt}
		\hbox{\otherfont kierujący pracą: \promotor}
		\vspace{12pt}  % zakomentuj, jezeli nie ma konsultanta
		\hbox{\otherfont konsultant: \konsultant} % zakomentuj, jezeli nie ma konsultanta
	}
	\vfill 
 
   \begin{center}
   \otherfont Gliwice,  \miesiac\ \the\year
   \end{center}	
	\restoregeometry
}
  

\cleardoublepage
 

\rmfamily
\normalfont


%%%%%%%%%%%%%%%%%% SPIS TRESCI %%%%%%%%%%%%%%%%%%%%%%
\pagenumbering{Roman}
\pagestyle{tylkoNumeryStron}
\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{stronyPozaNumeracja}{\value{page}}
\mainmatter
\pagestyle{empty}

\chapter*{Streszczenie}

Streszczenie pracy -odpowiednie pole w systemie APD powinno zawierac kopie tego streszczenia. Streszczenie, wraz ze slowami kluczowymi, nie powinno przekroczyc jednej strony.

{\bf Slowa kluczowe:} 2-5 slow (fraz) kluczowych, oddzielonych przecinkami

\addcontentsline{toc}{chapter}{Streszczenie}

\cleardoublepage

\pagestyle{NumeryStronNazwyRozdzialow}

%%%%%%%%%%%%%% wlasciwa tresc pracy %%%%%%%%%%%%%%%%%

\chapter{Wstęp}

\begin{itemize}
\item wprowadzenie w problem/zagadnienie
\item osadzenie problemu w dziedzinie
\item cel pracy
\item zakres pracy
\item zwięzła charakterystyka rozdziałów
\item jednoznaczne określenie wkładu autora, w przypadku prac wieloosobowych – tabela z autorstwem poszczególnych elementów pracy
\end{itemize}

\chapter{Analiza tematu}
W tej części zaprezentowana zostanie analiza tematu, w skład której wchodzi przedstawienie wyzwań, którym musi sprostać system oraz założenia dotyczące systemu. W dalszej części rozdziału znajduje się przegląd dostępnych rozwiązań na rynku komercyjnym.

Na rynku siłowni widać coraz większą konkurencję, a właściciele szukają sposobów jak zachęcić nowych klientów do uczęszczania na ich siłownie. Wiele z sieci pozwala na całodobowe korzystanie z ich obiektów, aby sprostać wymaganiom jak największej grupie klientów. Stawia to nowe wyzwania w organizacji pracy pracowników i sposobie działania obiektów. Dużym usprawnieniem byłaby możliwość zrezygnowania z recepcji na rzecz bramek wejściowych i wyjściowych, które kontrolowałby ważność karnetu oraz pilnowałby, aby w tej samej chwili na siłowni nie znajdowała się zbyt duża liczba osób.

Innym problemem jest coraz większa liczba sieci siłowni, która w swojej ofercie zawiera możliwość udziału w wydarzeniach grupowych, które pozwalają na uczestnictwo w grupowej sesji, gdzie pracownik siłowni nadzoruje czy uczestnicy wykonują ćwiczenia w sposób bezpieczny dla ich zdrowia. Pozwolenie na zgłoszenie chęci udziału w takim wydarzeniu poprzez aplikacje internetową może zwiększyć atrakcyjność oferty danej sieci siłowni w obliczu rosnącej konkurencji na rynku sieci siłowni.

Sieć siłowni staje w obliczu innych wyzwań, które nie są znane małym sieciom siłowni lub pojedynczym obiektom. Zarządzanie wyposażeniem może być utrudnione ze względu na liczbę posiadanych urządzeń i liczbę obiektów siłowni należących do sieci. System powinien gromadzić informacje na temat posiadanego sprzętu, aby skrócić czas, jaki jest potrzebny to przeprowadzenia inwentaryzacji posiadanych akcesoriów i sprzętów do ćwiczeń.

Innym wyzwaniem stawianym przed właścicielami siłowni jest stworzenie oferty treningów personalnych dla klientów, którzy oczekują indywidualnego podejścia do treningu. Rozwiązaniem jest stworzenie modułu, który pozwalałby na rezerwowanie przez klientów terminów treningów. Takie rozwiązanie może zwiększyć atrakcyjność danej sieci oraz pozwolić na sprawniejsze organizowanie czasu trenerów personalnych należących do sieci siłowni.

Ważnym wyzwaniem stawianym przez pandemię koronawirusa jest reagowanie na częste zmiany w przepisach dotyczących wstępu na obiekty sportowe. Taka sytuacja zmusza właścicieli do ciągłego monitorowania sytuacji i reagowania na zmiany dotyczące przepisów sanitarnych. Każda taka zmiana zmusza siłownię do wdrożenia nowych restrykcji w postaci limitów osób na siłowni. Pomocą w realizowaniu narzuconych obostrzeń byłoby stworzenie systemu, który ustalałby jaka jest maksymalna liczba osób w obiekcie na podstawie wprowadzonych danych. System powinien również zapewniać możliwość kontrolowania liczby osób, które znajdują się w danej chwili w obiekcie siłowni.

Kolejnym problemem jest ilość użytkowników korzystających z system informatycznego. Sieć siłowni w przeciwieństwie do pojedynczego obiektu musi obsługiwać żądania dużej liczby klientów. Aby zapewnić ciągłość działania systemu ważne jest aby stworzone oprogramowanie było skalowalne. Skalowanie może zostać wykonywane \textit{w górę} (poprzez zmodyfikowanie serwera w celu poprawy jego wydajności) lub \textit{w szerz} (rozdzielenie obciążenia pomiędzy większą liczbą serwerów)\cite{bib:mongodb_guide}. W wielu przypadkach skalowanie w górę jest zbyt kosztowne lub niemożliwe ze względu na ograniczenia technologiczne. W takim przypadku z pomocą przychodzi skalowanie wszerz, które pozwala na rozdzielenie obciążenia pomiędzy różnymi maszynami.

Aktualnie w sieci Internet możemy znaleźć wiele dostępnych rozwiązań \cite{bib:perfectgym} \cite{bib:wodguru}, które pokrywają wymagania funkcjonalne systemu. Duża część oferowanych aplikacji posiada możliwość zarządzania bazą klientów, prowadzenie inwentarza wyposażenia oraz opcję tworzenia bogatej oferty karnetów. Największe aplikacje posiadają w swoim zakresie funkcjonalnym rozwiązania wymienionych problemów, jednak żadne z nich nie posiada modułu odpowiedzialnego za zarządzanie dostępem do siłowni pod kątem obowiązujących przepisów sanitarnych. W celu zaproponowania systemu informatycznego, który będzie konkurencyjny na rynku, system powinien posiadać taki moduł.

Tworzony system powinien zapewnić wsparcie pracownikom w spełnianiu aktualnych norm i obostrzeń sanitarnych oraz dostarczyć podstawowe funkcjonalności potrzebne w prowadzeniu działalności sieci siłowni. W celu uniknięcia problemów z wydajnością, a tym samym złym doświadczeniom płynącym z korzystania z serwisu internetowego, system musi być podatny na zmiany. Aplikacja powinna cechować się skalowalnością w celu zapewnienia szybkości działania nawet w przypadku dużej liczby aktywnych użytkowników. Aby to osiągnąć system powinien zostać utworzony przy pomocy infrastruktury, która pozwoli na skalowanie wszerz. Warstwa serwerowa aplikacji powinna zostać utworzona w technologii i przy pomocy metodyk, które pozwolą na łatwe dostosowanie aplikacji do architektury mikro-usług.

\chapter{Wymagania i narzędzia}
W tym rozdziale opisane zostaną wymagania funkcjonalne systemu, które muszą zostać spełnione. W dalszej części znajdują się wymagania niefunkcjonalne oraz diagramy przypadków użycia. Rozdział kończy się opisem wykorzystanych narzędzi i metodyki pracy nad projektem.

	\section{Wymagania funkcjonalne} 
	Wymienione punkty stanowią listę wszystkich funkcjonalności jakie powinna oferować aplikacja. Opisują one jakie funkcje  zostały udostępnione użytkownikowi poprzez warstwę prezentacji oraz interfejs REST API.
		\begin{itemize}
			\item Tworzenie konta trenera personalnego - w systemie powinna istnieć możliwość dodawania kont, dla pracowników siłowni w celu zarządzania zasobami siłowni.
			\item Rejestracja konta klienta - system powinien pozwalać na samodzielne zarejestrowanie się użytkownika w celu skorzystania z funkcjonalności serwisu internetowego sieci siłowni.
			\item Logowanie się na wcześniej utworzone konto użytkownika - w celu weryfikacji użytkownika, system powinien pozwalać na autoryzację poprzez formularz logowania.
			\item Przeglądanie dostępnej oferty karnetów na siłownie - użytkownik w celu zakupu karnetu musi mieć możliwość przeglądania dostępnej oferty.
			\item Przedłużenie karnetu przypisanego do konta użytkownika - użytkownik posiadający już karnet może go przedłużyć.
			\item Zakup karnetu - użytkownik, powinien mieć możliwość zakupu karnetu w celu wejścia do siłowni.
			\item Utworzenie nowego typu karnetu - pracownicy siłowni powinni mieć możliwość stworzenia oferty karnetów.
			\item Usunięcie istniejącego rodzaju karnetu - pracownicy siłowni powinni mieć możliwość usunięcia z oferty wcześniej utworzonych karnetów.
			\item Edycja istniejącego typu karnetu - pracownicy siłowni powinni mieć możliwość dokonania zmian w istniejącej ofercie karnetów.
			\item Edycja informacji o koncie użytkownika - użytkownik serwisu powinien mieć możliwość edycji informacji zawartych w swoim profilu.
			\item Archiwizacja konta użytkownika - użytkownik serwisu powinien mieć możliwość zarchiwizowania swojego konta, gdy nie jest już zainteresowany dalszym korzystaniem z serwisu.
			\item Przeglądanie listy dostępny wydarzeń - użytkownicy powinni mieć możliwość przeglądania listy dostępnych wydarzeń.
			\item Utworzenie nowego wydarzenia - trenerzy personalni powinni mieć możliwość dodawania wydarzeń, które będą miały miejsce na terenie siłowni.
			\item Odwołanie wydarzenia - trener personalny powinien mieć możliwość odwołania zaplanowanego wydarzenia.
			\item Edycja wydarzenia - trener personalny powinien mieć możliwość wprowadzenia zmian w zaplanowanym wydarzeniu.
			\item Możliwość zapisania się na udział w wydarzeniu - klient powinien mieć możliwość zdeklarowania chęci udziału w wydarzeniu.
			\item Rezygnacja z udziału w wydarzeniu - klient powinien mieć możliwość zrezygnowania z udziału w wydarzeniu, w którym wcześniej zdeklarował chęć udziału.
			\item Utworzenie nowego obiektu siłowni - pracownicy powinni mieć możliwość utworzenia nowych obiektów sieci siłowni.
			\item Możliwość zdefiniowania ograniczeń dostępu do siłowni - pracownicy powinni mieć możliwość zdefiniowania limitu osób jaki może się znajdować w obiekcie siłowni.
			\item Możliwość dodania nowych pomieszczeń dla obiektu siłowni - pracownicy powinni mieć możliwość dodania nowych pomieszczeń do obiektu siłowni.
			\item Możliwość usunięcia pomieszczeń z obiektu siłowni - pracownicy powinni mieć możliwość usunięcia pomieszczenia, które zostało utworzone w danym obiekcie siłowni.
			\item Możliwość zdefiniowania akcesoriów i sprzętu do ćwiczeń - pracownicy powinni mieć możliwość zdefiniowania akcesoriów dostępnych w danym obiekcie siłowni.
			\item Edycja zdefiniowanych akcesoriów i sprzętu do ćwiczeń - pracownicy powinni mieć możliwość edycji wcześniej zdefiniowanych akcesoriów i sprzętu do ćwiczeń.
			\item Możliwość uruchomienia aplikacji w trybie bramki wejściowej - aplikacja powinna pozwolić użytkownikowi na uruchomienie aplikacji w trybie bramki wejściowej w celu kontroli liczby klientów znajdujących się w siłowni.
			\item Możliwość uruchomienia aplikacji w trybie bramki wyjściowej - aplikacja powinna pozwolić użytkownikowi na uruchomienie aplikacji w trybie bramki wyjściowej w celu kontroli liczby klientów wychodzących z siłowni.
			\item Przeglądanie listy dostępnych treningów indywidualnych - użytkownicy powinni mieć możliwość przeglądania listy dostępnych treningów osobisty.
			\item Możliwość zapisania się na udział w treningu indywidualnym - klient powinien mieć możliwość zapisania się na wcześniej utworzony trening indywidualny z trenerem personalnym.
			\item Utworzenie treningu indywidualnego - trener personalny powinien mieć możliwość utworzenia sesji treningów indywidualnych.
			\item Odwołanie treningu indywidualnego - trener personalny powinien mieć możliwość odwołania wcześniej zaplanowanych treningów personalnych.
			\item Rezygnacja z udziału w treningu personalnym - klient powinien mieć możliwość zrezygnowania z udziału w treningu personalnym.
			\item Odmowa wejścia na siłownie - bramka wejściowa powinna mieć możliwość odmówienia wejścia klientowi na siłownie w przypadku braku ważnego karnetu lub osiągnięciu maksymalnej liczby klientów na terenie obiektu siłowni.
			\item Sprawdzenie czy jest możliwość wejścia na siłownię - bramka wejściowa powinna informować o limicie osób, jaki może znajdować się w obiekcie siłowni.
			\item Otwarcie bramki wejściowej - bramka wejściowa powinna pozwolić na wejście na teren siłowni po spełnieniu warunków.
			\item Otwarcie bramki wyjściowej - bramka wyjściowa powinna pozwolić na wyjście z terenu siłowni.
		\end{itemize}
			
	\section {Wymagania niefunkcjonalne}
		\begin {itemize}
			\item Wyświetlanie elementów interfejsu użytkownika powinno zostać dostosowane do standardowych rozdzielczości ekranów komputerów osobistych.
			\item Poprawny sposób działania w nowoczesnych przeglądarkach: Mozilla Firefox, Google Chrome, Microsoft Edge.
			\item System powinien pozwolić na obsłużenie równoczesnego dostępu do aplikacji dla co najmniej stu użytkowników równocześnie.
			\item Aplikacja powinna być dostępna dla użytkowników przez siedem dni w tygodniu w godzinach 3-22.
		\end{itemize}
	
	\section {Diagram przypadków użycia (UML)}
	Diagram przypadków użycia pozwala na przedstawienie interakcji użytkowników z aplikacją i przedstawienie wymogów funkcjonalnych systemu w formie diagramów.
	
\begin{figure}[H]
	\centering
	\includegraphics[width=\textwidth]{diagram_przypadków_użycia.png}
	\caption{Diagram przypadków użycia.}
	\label{fig:3}
\end{figure}
	
	\section{Narzędzia}
	Do napisania projektu wykorzystano IDE (ang. \ang{Integrated development environment}) \textit{Visual Studio 2019}, które oferuję wiele narzędzi ułatwiających pisanie kodu w języku C\#. Głównymi zaletami tego środowiska jest bliska współpraca z środowiskiem \textit{.NET}, zapewnienie narzędzi w postaci odpluskwiacza (ang. \ang{debugger}) czy integracja z systemem kontroli wersji GIT. Innym użytym IDE wykorzystanym do pracy był \textit{WebStorm} firmy \textit{JetBrains} pozwalający na tworzenie aplikacji z platformą programistyczną \textit{Angular}. Do przeglądania kolekcji i dokumentów w bazie danych \textit{MongoDB} wykorzystano narzędzie \textit{MongoDB Compass}. Diagramy zostały utworzone dzięki wykorzystaniu narzędzi \textit{Astah UML} i \textit{diagrams.net}.
	
	\section {Metodyka pracy nad projektowaniem i implementacją}
	
	Prace rozpoczęto od utworzenia osobnych repozytoriów kodu z uwzględnieniem reprezentowanej warstwy aplikacji. Te warstwy to:
	\begin{itemize}
		\item \textit{Samson.Web.Application} - warstwa serwerowa aplikacji. Zawiera kod, który będzie uruchamiany po stronie serwera.
		\item \textit{Samson.Web.Ui} - warstwa prezentacji aplikacji. Zawiera kod, który będzie uruchamiany na maszynie klienta w celu prezentacji interfejsu użytkownika.
	\end{itemize}

	Następnie podzielono kod warstwy serwerowej na projekty platformy programistycznej .NET. Każdy z projektów został utworzony w taki sposób, aby mógł być zastąpiony w przypadku zmian szczegółów implementacji aplikacji. Podział wygląda następująco:
	\begin{itemize}
		\item \textit{Samson.Web.Application.Api} - projekt zawierający kod kontrolerów platformy ASP.NET, modele wykorzystywane do zapytań HTTP oraz klasy obiektów reprezentujące odpowiedzi serwera na żądania HTTP.
		\item \textit{Samson.Web.Application.Identity} - projekt, który zawiera konfigurację oraz serwisy odpowiedzialne za autoryzację użytkownika.
		\item \textit{Samson.Web.Application.Infrastructure} - projekt posiadający w swojej strukturze utworzone atrybuty, rozszerzenia klas, kod oprogramowania pośredniczącego (ang. \ang Middleware) oraz interfejsy wykorzystywane pomiędzy, różnymi projektami rozwiązania .NET.
		\item \textit{Samson.Web.Application.Persistence} - projekt zawierający kod klas implementujących wzorzec repozytorium. Odpowiada za dodawania i modyfikacje modeli w bazie danych.
		\item \textit{Samson.Web.Application.ReadModels} - projekt platformy .NET implementujący odczyt z bazy danych.
		\item \textit{Samson.Web.Application.UnitTests} - projekt biblioteki NUnit zawierający kod testów jednostkowych.
		\item \textit{Samson.Web.Application.WebHost} - główny projekt aplikacji. Zawiera konfigurację warstwy serwerowej aplikacji
		\item \textit{Samson.Web.Models} - projekt zawierający modele, enumy oraz domenę aplikacji
	\end{itemize}
	
	W następnych krokach implementowano aplikacje tworząc w pierwszej kolejności kontrolery platformy ASP.NET, a w krokach późniejszych dodawano szczegóły implementacji w postaci domeny, warstwy zapisu, warstwy odczytu, modeli. Najważniejsze klasy domenowe zostały uzupełnione testami jednostkowymi w celu zapewnienia poprawności działania. Gdy część serwerowa aplikacji została zakończona, rozpoczęto prace nad warstwą interfejsu użytkownika. Warstwa prezentacji była implementowana w następującej kolejności:
	\begin{enumerate}
		\item Opakowanie komponentów z bibliotek zewnętrznych
		\item Utworzenie widoków i formularzy
		\item Integracja z warstwą serwerową
		\item Dodanie obsługi żetonu JWT w komunikacji z warstwą serwerową
	\end{enumerate}

\chapter{Specyfikacja zewnętrzna}
W tym rozdziale można znaleźć spis wymagań sprzętowych, których spełnienie jest pozwala na poprawne działanie systemu. W dalszej części znajduje się instrukcja instalacji systemu oraz opis sposoby jego aktywacji. Kolejne podrozdziały opisują kategorie użytkowników i metody, które zostały wykorzystane do zabezpieczenia wrażliwych danych. Rozdział kończy się przykładami działania aplikacji w postaci zrzutów ekranu i opisów.

\section {Wymagania sprzętowe}
Aby aplikacja działała w poprawny sposób wymagany są:
	\begin{itemize}
		\item System operacyjny w wersji \cite{bib:requirementsWin}\cite{bib:requirementsMac}\cite{bib:requirementsLinux}\cite{bib:requirementsMongo}\cite{bib:requirementsFramework}:
		\begin {itemize}
			\item \textit{Windows} w wersjach 11/10/8.1
			\item \textit{Windows 7} z \textit{Service Pack 1}
			\item \textit{Windows Server Core 2012 R2}
			\item Nano Server w wersji nowszej niż 1809
			\item \textit{MacOS} 12.0 \textit{Monterey}
			\item \textit{MacOS} 11.0 \textit{Big Sur}
			\item \textit{MacOS} 10.15 \textit{Catalina}
			\item \textit{Linux Alpine} w wersji nowszej niż 3.12 włącznie
			\item \textit{Linux CentOS} w wersjach 8/7
			\item \textit{Linux Debian} w werjsach 11/10/9
			\item \textit{Linux Fedora} w wersjach 35/34/33/32
			\item \textit{Linux OpenSuse} w wersji 15
			\item \textit{Linux RedHat} w wersjach 8/7
			\item \textit{Linux SLES} w wersji 15
			\item \textit{Linux Ubuntu} w wersjach 21.10/21.04/20.04
		\end {itemize}	
		\item Procesor z więcej niż jednym rdzeniem o taktowaniu nie mniejszym niż 1GHZ
		\item Pamięć operacyjna większa niż 4GB RAM
		\item Minimalna przestrzeń na dysku to 4,5 GB pamięci
		\item Zainstalowana nowoczesna przeglądarka WWW taka jak:
		\begin{itemize}
			\item \textit{Google Chrome} w najnowszej wersji
			\item \textit{Mozilla Firefox} w najnowszej wersji
			\item \textit{Microsoft Edge} w najnowszej wersji
			\item \textit{Opera} w najnowszej wersji
		\end{itemize}
	\end{itemize}

Są to minimalne wymagania do uruchomienia bazy danych MongoDB oraz aplikacji z wykorzystaniem platformy uruchomieniowej .NET 5. Ponadto wymagane są dodatkowe zasoby potrzebne do uruchomienia przeglądarki w której wyświetlony zostanie interfejs użytkownika.

\section {Instalacja}

\subsection{Instalacja bazy danych MongoDB}
W celu zainstalowania aplikacji, trzeba spełnić wymagania wymienione w poprzednim punkcie. Instalacja zostaje rozpoczęta od pobrania i zainstalowania serwera bazy danych MongoDB w wersji Community \href{https://www.mongodb.com/try/download/community}{z strony twórców}.
\FloatBarrier
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalcja_mongodb/mongodbsite}
	\caption{Strona z której można pobrać instalator serwera bazy danych MongoDB}
	\label{fig:mongodbsite}
\end{figure}
\afterpage{\clearpage}
\FloatBarrier

Instalacja oprogramowania do zarządzania bazą danych rozpoczyna się od uruchomienia wcześniej pobranego kreatora.
\FloatBarrier
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalcja_mongodb/mongodb1}
	\caption{Rozpoczęcie instalacji serwera}
	\label{fig:mongodb1}
\end{figure}
\afterpage{\clearpage}
\FloatBarrier

Po zapoznaniu się z warunkami licencyjnymi, aby kontynuować użytkownik musi zaznaczyć pole z podpisem \textit{I accept the terms in the License Agreement}, a następnie przycisnąć \textit{Next}.
\FloatBarrier
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalcja_mongodb/mongodb2}
	\caption{Umowa licencyjna \textit{MongoDB Community Edition}}
	\label{fig:mongodb2}
\end{figure}
\afterpage{\clearpage}
\FloatBarrier

W widoku formularza wyboru typu instalacji trzeba wybrać opcję \textit{Completed}, aby zainstalować wszystkie potrzebne narzędzia do działania serwera.
\FloatBarrier
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalcja_mongodb/mongodb3}
	\caption{Typ instalacji w instalatorze \textit{MongoDB Community Edition}}
	\label{fig:mongodb3}
\end{figure}
\afterpage{\clearpage}
\FloatBarrier

W następnym widoku, gdzie widać konfiguracje serwera, ustawienia powinny zostać domyślne.
\FloatBarrier
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalcja_mongodb/mongodb4}
	\caption{Początkowa konfiguracja serwera bazy danych}
	\label{fig:mongodb4}
\end{figure}
\afterpage{\clearpage}
\FloatBarrier

Po naciśnięciu przycisku \textit{Next} powinna być widoczna opcja zainstalowania \textit{MongoDB Compass}. Oprogramowanie \textit{MongoDB Compass} jest opcjonalne, więc opcja instalacji może zostać odznaczona.
\FloatBarrier
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalcja_mongodb/mogndodb5}
	\caption{Informacja o możliwości instalacji klienta bazy danych \textit{MongoDB Compass}}
	\label{fig:mogndodb5}
\end{figure}
\afterpage{\clearpage}
\FloatBarrier

W następnym kroku, aby zainstalować serwer bazy danych trzeba nacisnąć przycisk \textit{Install}.
\FloatBarrier
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalcja_mongodb/mongodb6}
	\caption{Rozpoczęcie instalacji \textit{MongoDB}}
	\label{fig:mongodb6}
\end{figure}
\afterpage{\clearpage}
\FloatBarrier

Aby zakończyć instalację po zakończeniu się procesu instalacji trzeba przycisnąć przycisk \textit{Finish}. W tym momencie na maszynie użytkownika powinna znajdować się w pełni sprawny serwer bazy danych MongoDB.
\FloatBarrier
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalcja_mongodb/mongodb_finish}
	\caption{Zakończenie instalacji \textit{MongoDB}}
	\label{fig:mongodbfinish}
\end{figure}
\afterpage{\clearpage}
\FloatBarrier

\subsection{Instalacja środowiska .NET 5}
Podobnie jak w przypadku \textit{MongoDB}, aby zainstalować środowisko \textit{.NET 5} trzeba przejść na \href{https://dotnet.microsoft.com/en-us/download/dotnet/5.0}{stronę, gdzie możliwe jest pobranie SDK .NET 5}. W pierwszej kolejności wymagane jest wybranie odpowiedniej wersji instalatora dla zainstalowanego systemu operacyjnego oraz architektury maszyny.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_dotnet5/dotnet_sdk}
	\caption{Strona twórców środowiska \textit{.NET}}
	\label{fig:dotnetsdk}
\end{figure}

W kolejnym kroku trzeba uruchomić pobrany kreator instalacji \textit{SDK .NET 5}. Pierwszym widokiem jest formularz informujący o dostępnej dokumentacji oraz składnikach instalacji. Po zapoznaniu się z informacji trzeba przycisnąć przycisk \textit{Zainstaluj} w celu instalacji środowiska uruchomieniowego.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_dotnet5/dotnet1}
	\caption{Rozpoczęcie instalacji środowiska \textit{.NET }5}
	\label{fig:dotnet1}
\end{figure}

W kolejnym kroku kreator zainstaluje na maszynie wymagane składniki. Kiedy instalator zakończy działanie zamknięcie kreatora wymaga przyciśnięcia w przycisk \textit{Zamknij}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_dotnet5/dotnet_finish}
	\caption{Zakończenie instalacji środowiska \textit{.NET 5}}
	\label{fig:dotnetfinish}
\end{figure}

Aby sprawdzić czy instalacja przebiegła pomyślnie trzeba uruchomić konsolę \textit{Windows Powershell} dla systemów rodziny \textit{Windows} lub odpowiedniego terminala dla posiadanej dystrybucji \textit{Linux}. Następnie trzeba wpisać komendę \textit{dotnet --version}. Jeśli instalacja przebiegła pomyślnie użytkownik powinien zobaczyć w konsoli informację o zainstalowanej wersji środowiska \textit{.NET}.

\subsection{Instalacja środowiska Node.js}
Przedostatnim krokiem, jaki trzeba wykonać, aby zainstalować projekt jest instalacja środowiska, które pozwoli na uruchomienie serwera WWW dzięki, któremu będzie można uruchomić aplikację stworzoną przy pomocy platformy programistycznej Angular. Serwer WWW musi mieć możliwość przekierowania wszystkich zapytań do wybranego adresu URL. Jest to istotne w przypadku aplikacji typu SPA, gdzie to aplikacja odpowiada za nawigacje pomiędzy widokami. W tej pracy zaprezentowana zostanie instalacja serwera \textit{http-server}, który obsługuje takie przekierowania.

W pierwszej kolejności zainstalowana musi być platforma uruchomieniowa \textit{Node.js}, która pozwala na wykonywanie skryptów napisanych w języku \textit{JavaScript}. Kreator instalacji można pobrać z strony twórców \href{https://nodejs.org/en/}{środowiska}.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_nodejs/node_page}
	\caption{Strona Node.js}
	\label{fig:nodepage}
\end{figure}

Kolejnym krokiem jest uruchomienie programu instalującego środowisko uruchomieniowe. Aby to zrobić trzeba przejśc w miejsce gdzie pobrano plik instalatora a następnie uruchomić go. Wyświetlony powinien zostać następujący widok.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_nodejs/node1}
	\caption{Rozpoczęcie instalacji środowiska \textit{Node.js}}
	\label{fig:node1}
\end{figure}

Po przyciśnięciu przycisku \textit{Next} oczom użytkownika powinien ukazać się formularz z informacjami o licencji oprogramowania. Aby przejść dalej użytkownik powinien zapoznać sie z licencją a następnie zaakceptować ją. Po zaakceptowaniu licencji użytkownik musi przejść do kolejnego widoku za pomocą przycisku \textit{Next}.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_nodejs/node2}
	\caption{Licencja środowiska \textit{Node.js}}
	\label{fig:node2}
\end{figure}

Następnym etapem instalacji jest wybór ścieżki do folderu, gdzie ma zostać zainstalowane oprogramowanie. Po wyborze dogodnej lokalizacji trzeba przejść do kolejnego widoku.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_nodejs/node3}
	\caption{Ścieżka do folderu docelowego \textit{Node.js}}
	\label{fig:node3}
\end{figure}

W kolejnym kroku użytkownik musi wybrać składniki instalacji. W tym przypadku pozostać powinny domyślne opcje. Istotne jest aby zainstalowane zostało narzędzie \textit{NPM}, które pozwoli na instalacje serwera WWW.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_nodejs/node4}
	\caption{Składniki instalatora Node.js}
	\label{fig:node4}
\end{figure}

Jednym z ostatnich kroków instalatora jest widok z informacją o możliwości zainstalowania dodatkowego narzędzia \textit{Chocolatey}. Narzędzie to nie jest potrzebne w działaniu, więc można wyłączyć opcję instalacji narzędzia.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_nodejs/node5}
	\caption{Formularz umożliwający instalację dodatkowego narzędzia \textit{Cocolatey}}
	\label{fig:node5}
\end{figure}

W kolejnych etapach instalacji użytkownik powinien uruchomić instalacje za pomocą przycisku \textit{Install}. Po zakończonej instalacji instalator powinien wyświetlić informację o zakończeniu pracy.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{../zrzuty_ekranu/instalacja_nodejs/node6}
	\caption{Potwierdzenie instalacji środowiska \textit{Node.js}}
	\label{fig:node6}
\end{figure}

Aby sprawdzić czy instalacja przebiegła pomyślnie, można uruchomić polecenie \textit{node -v}, które powinno zwrócić informację o zainstalowanej wersji \textit{Node.js}.

\subsection {Instalacja \textit{http-server}}
Ostatnim etapem instalacji systemu jest instalacja serwera WWW, który obsługuje możliwość przekierowań do pliku \textit{index.html}. Aby zainstalować serwer \textit{http-server} w terminalu trzeba uruchomić następujące polecenie:
\begin{figure} [H]
	\centering
	\begin{lstlisting}
		npm install -g http-server
	\end{lstlisting}
	\caption{Instalacja paczki \textit{http-server}}
	\label{fig:httpServerInstall}
\end{figure}

Polecenie to zainstaluje paczkę \textit{npm} dla użytku globalnego. Dzięki instalacji globalnej użytkownik będzie mógł uruchomić serwer WWW z każdej lokalizacji.

\section {Sposób aktywacji}
\subsection{Uruchomienie warstwy serwerowej}
Aby uruchomić aplikację stworzoną z wykorzystaniem platformy .NET istnieje potrzebna skompilowania jej do pliku wykonywalnego. W celu utworzenia pliku \textit{exe} użytkownik musi przejść do folderu w którym znajduje się projekt \textit{Samson.Web.Application}, a następnie z poziomu terminala trzeba wywołać komendy:
\begin{figure} [H]
	\centering
	\begin{lstlisting}
		dotnet restore;
		dotnet build --configuration Release
	\end{lstlisting}
	\caption{Kompilacja projektu \textit{ASP.NET}}
	\label{fig:dotnetCompilation}
\end{figure}
Pierwsza z komend wymusza instalację zewnętrznych zależności, które są zawarte w postaci paczek \textit{NuGet'owych}. Paczki te pozwalają na udostępnianie kod napisanego przy wykorzystaniu platformy \textit{.NET}, a następnie mogą zostać wykorzystane do innych projektów przy pomocy narzędzia \textit{NuGet}. Druga komenda buduje projekt i zwraca wynik w postaci dynamicznych bibliotek \textit{dll} i pliku wykonywalnego \textit{exe}.

W folderze \textit{./Samson.Web.Application.WebHost/bin/Release/net5.0} powinien powstać folder zawierający wyniki kompilacji. Następnie w celu uruchomienia pliku wykonywalnego użytkownik powinien przejść do folderu ./Samson.Web.Application.WebHost/bin/Release/net5.0 przy pomocy komendy:
\begin{figure} [H]
	\centering
	\begin{lstlisting}
		cd ./Samson.Web.Application.WebHost/bin/Release/net5.0
	\end{lstlisting}
	\caption{Przejście do folderu zawierającego plik wykonywalny}
	\label{fig:aspnetChangeFolder}
\end{figure}

Aby uruchomić warstwę serwerową aplikacji wymagane jest dodanie odpowiednich zmiennych środowiskowych przy pomocy poniższego polecenia. Przeznaczenie zmiennych jest następujące:
\begin{itemize}
	\item \textit{MongoDB:DatabaseName} - nazwa bazy danych jaka zostanie utworzona w środowisku \textit{MongoDB}.
	\item \textit{Authentication:JWT:Key} - klucz wykorzystywany do funkcji mieszającej, która jest wykorzystywana do zabezpieczenia żetonu \textit{JWT}.
	\item \textit{ASPNETCORE\_ENVIRONMENT} - oznaczenie typu środowiska. Nie powinna zostać zmieniana.
	\item \textit{ConnectionString:MongoDB:Atlas} - ciąg znaków określający parametry połączenia z bazą danych. Jeżeli w trakcie instalacji serwera \textit{MongoDB} wartości domyślnie nie zostały zmienione to proponowany ciąg znaków powinien pozwolić na poprawne połączenie z bazą danych.
\end{itemize}
Poniższe wartości mogą zostać zmodyfikowane, ale zalecane jest aby pozostały w niezmienione formie ze względu na proponowaną w wcześniejszych krokach konfigurację.
\begin{figure} [H]
	\centering
	\begin{lstlisting}
		$env:MongoDB:DatabaseName="SamsonDatabase";
		$env:Authentication:JWT:Key="Top secret key to provide JWT token";
		$env:ASPNETCORE_ENVIRONMENT="Release"
		$env:ConnectionString:MongoDB:Atlas="mongodb://localhost:27017/?readPreference=primary&ssl=false";
	\end{lstlisting}
	\caption{Ustawienie wartości zmiennych środowiskowych}
	\label{fig:varEnvironment}
\end{figure}

Ostatnim krokiem w uruchomieniu warstwy serwerowej jest uruchomienie poniższego polecenia.
\begin{figure} [H]
	\centering
	\begin{lstlisting}
		start Samson.Web.Application.WebHost.exe
	\end{lstlisting}
	\caption{Uruchomienie warstwy serwerowej aplikacji}
	\label{fig:aspNetRun}
\end{figure}

\subsection{Uruchomienie warstwy prezentacji}
Tak jak w przypadku warstwy serwerowej, warstwa prezentacji musi zostać skompilowana do postaci, która może zostać obsłużona przez serwer WWW. Aby to zrobić trzeba uruchomić terminal a następnie przejść do lokalizacji w której znajduje się projekt \textit{Samson.Web.Ui}. Kolejnym krokiem jest wywołanie poleceń, które zainstalują wymagane zależności a następnie utworzą paczkę wynikową:
\begin{figure} [H]
	\centering
	\begin{lstlisting}
		npm install; npm run build
	\end{lstlisting}
	\caption{Polecenie, które tworzy paczkę możliwą do uruchomienia przez serwer WWW}
	\label{fig:installAndBuildAngularProejct}
\end{figure}

Końcowym krokiem uruchamiania warstwy interfejsu użytkownika jest uruchomienie serwera WWW z opcją przekierowania do pliku index.html.
\begin{figure} [H]
	\centering
	\begin{lstlisting}
		cd dist/samson-web-ui; http-server --proxy http://localhost:8080?
	\end{lstlisting}
	\caption{Polecenie, które tworzy paczkę możliwą do uruchomienia przez serwer WWW}
	\label{fig:runWWWServer}
\end{figure}

Po wywołaniu poprzedniego polecania aplikacja internetowa powinna być dostępna pod adresem: \textit{http://localhost:8080}.

\section {Kategorie użytkowników}

Aplikacja internetowa kategoryzuje użytkowników na dwie kategorie:
\begin{itemize}
	\item Trenerów personalnych - pełnią rolę administratorów w systemie. Posiadają możliwość modyfikacji zasobów siłowni, takich jak sprzęt do ćwiczeń, obiektów, pomieszczeń oraz możliwość organizacji wydarzeń i treningów indywidualnych.
	\item Klientów - użytkownik który posiadają możliwość zakupu karnetu, zgłoszenia chęci udziału w treningu indywidualnym lub wydarzeniu.
\end{itemize}

\section {Kwestie bezpieczeństwa}

System wykorzystuje żeton bezpieczeństwa \textit{JWT}. Żeton ten generowany jest w części serwerowej aplikacji w trakcie logowania użytkownika. Kiedy użytkownik poprawnie zaloguje się do systemu, serwer przesyła żeton do warstwy interfejsu użytkownika, gdzie zostaje zapisany w \textit{localstorage} przeglądarki. Warstwa prezentacji dodaje za każdym razem żeton do nagłówka żądania protokołu HTTP, które będzie wymagało uwierzytelnienia użytkownika. W momencie gdy warstwa serwerowa otrzyma taki żeton sprawdza zapisane w nim dane o jego terminie ważności i dostępach, które posiada użytkownik. Jeśli użytkownik systemu posiada odpowiednie uprawnienia do zasobu to otrzymuje odpowiedź na żądanie, w przeciwnym razie system zwraca informacje o błędzie oznaczone statusem 401 (Unauthorized). Brak przesłania żetonu w nagłówku do metody wymagającej autoryzacji skończy się za każdym razem błędem oraz informacją o próbie nieautoryzowanego dostępu do wrażliwych danych.

\section {Przykład działania}
W tej części pracy zaprezentowano przykładowe scenariusze działania systemu. Prezentowane są one z perspektywy różnych użytkowników, ze względu na różnice w posiadanych uprawnieniach.

\subsection{Rejestracja i logowanie}
Jako pierwsze zaprezentowane zostanie logowanie i rejestracja w systemie. Są to jedne z początkowych widoków jakie zobaczyć użytkownik korzystając z systemu.
\subsubsection{Rejestracja}
Rejestracja pozwala na utworzenie, konta klienta. Konto daje dostęp do systemu i jego możliwości.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/rejestracja_logowanie/rejestracja}
	\caption{Rejestracja klienta}
	\label{fig:rejestracja}
\end{figure}
Jeżeli użytkownik wypełni wszystkie wymagane dane oraz wybierze nazwę konta, która nie została wcześniej wykorzystane przez innego klienta to powinien zobacz informację o poprawnie stworzonym użytkowniku.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/rejestracja_logowanie/konto_utworzone}
	\caption{Klient został zarejestrowany w systemie}
	\label{fig:kontoutworzone}
\end{figure}

\subsubsection{Logowanie}
Klient i trener personalny ma możliwość zalogowania się do systemu w celu skorzystania z jego funkcjonalności.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/rejestracja_logowanie/logowanie}
	\caption{Widok logowania do systemu}
	\label{fig:logowanie}
\end{figure}
Użytkownik zostanie zalogowany jeśli wypełni w sposób poprawny dane w formularzu logowania.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/rejestracja_logowanie/zalogowano}
	\caption{Widok po zalogowaniu do systemu}
	\label{fig:zalogowano}
\end{figure}

\subsection{Administracja systemem}
System powinien udostępniać możliwość zarządzania systemem oraz zasobami sieci siłowni przy jego pomocy. Aplikacja pozwala na zarządzanie obiektami siłowni, pomieszczeniami, które do tych obiektów zostały przypisane, sprzętem do ćwiczeń, akcesoriami oraz ofertą karnetów.

\subsubsection{Dodawanie konta trenerów personalnych}
Użytkownik ma możliwość utworzenia konta trenera personalnego.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/trener_personalny/tworzenie_konta_trenera_personalnego}
	\caption{Formularz tworzenia konta trenera personalnego}
	\label{fig:tworzeniekontatrenerapersonalnego}
\end{figure}

\subsubsection{Zarządzanie obiektami siłowni}
Trenerzy personalni pełnią rolę administratorów, co pozwala im na zarządzanie obiektami siłowni.
W pierwszej kolejności utworzony zostanie nowy obiekt sieci siłowni. W trakcie procesu dodawania obiektu wymagane jest, aby podana została nazwa oraz ilość osób jaka może przebywać na jednym metrze kwadratowym siłowni.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/obiekty/tworzenie}
	\caption{Formularz tworzenia obiektu siłowni}
	\label{fig:tworzenie}
\end{figure}

W formularzu edycji obiektów powinna wyświetlić się możliwość wybrania wcześniej utworzonej siłowni w celu aktualizacji informacji o niej. Widok ten poza edycją nazwy i ilości osób jaka może przebywać na jednym metrze kwadratowym pozwala również na zarchiwizowanie obiektu siłowni.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/obiekty/edycja}
	\caption{Formularz edycji i archiwizacji obiektów siłowni}
	\label{fig:edycja}
\end{figure}


\subsubsection{Zarządzanie pomieszczeniami}
System udostępnia możliwość dodawania pomieszczeń do obiektów siłowni. Pomieszczenia są istotne ze względu na możliwość przypisania do nich akcesoriów do ćwiczeń oraz wyliczania maksymalnej liczby osób, która może znajdować się na siłowni. W formularzu muszą zostać podane informacje o siłowni w której znajduje się pomieszczenie, nazwa pomieszczenia oraz jego szerokość i długość.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/pomieszczenia/dodawanie}
	\caption{Formularz dodawania pomieszczenia do obiektu siłowni}
	\label{fig:dodawanie_pomieszczenia}
\end{figure}

Wcześniej utworzone pomieszczenie może zostać zarchiwizowane.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/pomieszczenia/usuwanie}
	\caption{Formularz archiwizacji pomieszczenia}
	\label{fig:archwizacja_pomieszczenia}
\end{figure}


\subsubsection{Zarządzaniem sprzętem do ćwiczeń i akcesoriami}
System informatyczny powinien udostępniać możliwość stworzenia listy posiadanych akcesoriów do ćwiczeń. Dzięki takiej liście personel ma dostęp do informacji o posiadanym sprzęcie co pozwala na przeprowadzanie inwentaryzacji zasobów. Aby dodać sprzęt wymagane jest podanie informacji o kodzie producenta, nazwie, typie oraz siłowni w której znajduje się akcesorium.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/akcesoria/dodawanie_akcesoriun}
	\caption{Formularz dodawania sprzętu do ćwiczeń}
	\label{fig:dodawanieakcesoriun}
\end{figure}

Wcześniej utworzone informacje o akcesorium mogą zostać zaktualizowane lub zarchiwizowane przy pomocy formularza.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/akcesoria/aktualizacja_akcesorium}
	\caption{Formularz edycji i archiwizacji akcesoriów}
	\label{fig:aktualizacjaakcesorium}
\end{figure}

\subsubsection{Zarządzanie ofertą karnetów}
Ostatnią funkcjonalnością udostępnioną przez moduł administracji jest funkcja zarządzania ofertą karnetów. System pozwala na utworzenie nowego typu karnetu, jeśli podane zostaną informacje o jego nazwie, czasie trwania w dniach oraz cenie.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/karnety/tworzenie_karnetu}
	\caption{Formularz dodawania karnetu do oferty}
	\label{fig:tworzeniekarnetu}
\end{figure}

Wcześniej utworzone karnety mogą zostać zaktualizowane lub zarchiwizowane.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/karnety/edycja_karnetu}
	\caption{Formularz edycji i archiwizacji karnetów}
	\label{fig:edycjakarnetu}
\end{figure}


\subsection{Wydarzenia}
Moduł wydarzeń udostępnia możliwość tworzenia, przeglądania, anulowania i zgłaszania chęci wzięcia udziału w wydarzeniu w zależności od rodzaju konta użytkownika.
\subsubsection{Tworzenie wydarzenia}
Konto trenera personalnego pozwala na tworzenie wydarzeń w których będą mogli brać udział klienci w określonym czasie.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/wydarzenia/dodawanie_wydarzenia}
	\caption{Forumlarz tworzenia wydarzenia}
	\label{fig:dodawaniewydarzenia}
\end{figure}

\subsubsection{Listy wydarzeń}
Klienci i trenerzy personalni mają dostęp do listy wszystkich wydarzeń. Z poziomu tej listy użytkownicy mogą przejść do poglądu wydarzenia, gdzie znajdują się dodatkowe opcje zarządzania wydarzeniem.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/wydarzenia/wszystkie_wydarzenia}
	\caption{Lista wszystkich wydarzeń}
	\label{fig:wszystkiewydarzenia}
\end{figure}

Trenerzy personalni mają dodatkowo możliwość wyświetlenia listy wydarzeń, które sami stworzyli.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/wydarzenia/trener_lista_wydarzen}
	\caption{Lista utworzony wydarzeń przez trenera personalnego}
	\label{fig:trenerlistawydarzen}
\end{figure}

Klienci natomiast mają możliwość wyświetlenia wydarzeń w których zgłosili chęć wzięcia udziału.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/wydarzenia/klient_lista_wydarzen}
	\caption{Lista wydarzeń klienta}
	\label{fig:klientlistawydarzen}
\end{figure}

\subsubsection{Podgląd wydarzeń}
Systemu udostępnia widok poglądu wydarzenia. Użytkownicy mogą przeglądać wszystkie wydarzenia, ale dostępne opcje są zależne od roli jaką pełni danych użytkownik. Trener personalny w podglądzie wydarzenia zobaczy opcję anulowania wydarzenia.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/wydarzenia/trener_podlad_wydarzenie}
	\caption{Podgląd wydarzenia jako trener personalny}
	\label{fig:trenerpodladwydarzenie}
\end{figure}

Klient na tym samym widoku zobaczy opcję zgłoszenia chęci udziału w wydarzeniu lub zrezygnowania z udziału w wydarzeniu.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/wydarzenia/klient_podlad_wydarzenia}
	\caption{Pogląd wydarzenia jako klient}
	\label{fig:klientpodladwydarzenia}
\end{figure}

\subsection{Treningi indywidualne}
Kolejnym modułem w systemie jest moduł treningów indywidualnych. Moduł ten pozwala na organizowanie treningów w których brać będzie udział klient pod nadzorem trenera personalnego. Pozwala na to na utworzenie oferty dostosowanej do klientów, którzy chcą ćwiczyć pod okiem specjalistów.

\subsubsection{Tworzenie treningów indywidualnych}
Trener personalny posiada możliwość utworzenia treningu. Aby dodać trening, użytkownik z rolą trenera musi wskazać w formularzu, gdzie odbędzie się trening oraz w jakim terminie.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/treningi/dodawanie_treningu}
	\caption{Formularz dodawania treningu}
	\label{fig:dodawanietreningu}
\end{figure}

\subsubsection{Listy treningów indywidualnych}
System pozwala klientom na pogląd listy dostępnych treningów. Treningi w statusie \textit{Open} oznaczają treningi, w których żaden użytkownik nie zgłosił chęci wzięcia udziału.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/treningi/klient_dostepne_treningi}
	\caption{Lista dostępnych treningów indywidualnych}
	\label{fig:klientdostepnetreningi}
\end{figure}

Z perspektywy klienta dostępna jest również lista treningów na które się zapisał.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/treningi/klient_lista_treningow}
	\caption{Lista treningów na które zapisał się klient}
	\label{fig:klientlistatreningow}
\end{figure}

Trener personalny natomiast posiada możliwość poglądu utworzonych przez siebie wydarzeń.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/treningi/trener_lista_treningow}
	\caption{Lista utworzonych treningów przez trenera}
	\label{fig:trenerlistatreningow}
\end{figure}

Lista pozwala na odwołanie treningu lub potwierdzenie go. To jakie opcje są dostępne jest zależne od statusu w jakim znajduje się dany trening.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/treningi/trening_opcje_trener}
	\caption{Lista z dostępnymi opcjami zarządzania treningiem}
	\label{fig:treningopcjetrener}
\end{figure}

\subsection{Karnety}
System posiada moduł karnetów, gdzie klient może sprawdzić ważność karnetu, dostępną ofertę, zakupić lub przedłużyć karnet.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/karnety/lista_karnetow}
	\caption{Oferta karnetów oraz informacje o posiadanym karnecie}
	\label{fig:listakarnetow}
\end{figure}

\subsection{Tryb bramek}
Istotnym z punktu widzenia pandemicznych obostrzeń jest moduł bramek. Systemu udostępnia tryb bramek, które pozwala na podłączenie aplikacji do bramek i wyświetlaczy w celu kontroli liczby osób znajdujących aktualnie na siłowni.
\subsubsection{Bramka wejściowa}
Głównym zadaniem bramki wejściowej jest kontrolowanie ważności posiadanego karnetu oraz kontroli czy na siłowni nie znajduje się zbyt duża liczba osób w stosunku do obowiązujących obostrzeń. Aby wejść na siłownie klient musi podać lub zeskanować za pomocą skanera swój kod identyfikacyjny. Formularz powinien w tym momencie wyświetlić informację o tym czy istnieje możliwość wejścia na siłownie. To czy można wejść na siłownię zależy od liczby osób, która się na siłowni oraz ważności karnetu klienta.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/bramki/bramka_wejsciowa}
	\caption{Widok wyświetlany na wyświetlaczu bramki wejściowej}
	\label{fig:bramkawejsciowa}
\end{figure}

\subsubsection{Bramka wyjściowa}
Zadaniem bramki wyjściowej jest usuwanie z listy klientów osób, które już nie korzystają z usług danego obiektu siłowni.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../zrzuty_ekranu/dzialanie/bramki/bramka_wyjsciowa}
	\caption{Widok wyświetlany na wyświetlaczu bramki wyjściowej}
	\label{fig:bramkawyjsciowa}
\end{figure}

\chapter{Specyfikacja wewnętrzna}
Rozdział przestawia ideę stająca za architekturą wykorzystaną do stworzenia projektu. Następnie opisana zostaje architektura systemu z podziałem na warstwy z uwzględnieniem komunikacji pomiędzy nimi. W dalszej części rozdziału znajduje się przedstawienie organizacji bazy danych i spis wykorzystanych bibliotek zewnętrznych. W kolejnej części znajduje się przegląd najważniejszych klas i algorytmów. Rozdział zakończony jest opisem zastosowanych wzorców projektowych.

\section{Idea}
Głównym celem stworzenia systemu była chęć ułatwienia prowadzenia sieci siłowni w dobie pandemii koronawirusa. System udostępnia rozwiązania pozwalające na kontrolowanie liczby osób znajdujących się na siłowni oraz zdefiniowanie różnych limitów z uwzględnieniem lokalizacji danego obiektu. W przypadku sieci siłowni istotne jest stworzenie rozwiązania, które będzie przygotowane zmiany w liczbie siłowni i klientów. System powinien być na tyle skalowalny by obsłużyć dużą liczbę jednoczesnych żądań. Ponadto sieć siłowni powinna posiadać aplikacje internetową, która pozwoli na korzystanie z systemu na wielu różnych urządzeniach.

\section{Architektura systemu}
System został podzielony na dwie główne warstwy. Architektura została zaprezentowana w postaci następującego rysunku:
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../diagramy/architektura}
	\caption{Architektura systemu}
	\label{fig:architektura}
\end{figure}

\subsubsection{Warstwa serwerowa}
Warstwa serwerowa to część aplikacji znajdująca się na serwerze. Jej głównym zadaniem jest obsługiwanie żądań wysyłanych przez część kliencką systemu. Warstwa serwerowa składa się z głównego projektu \textit{Samson.Web.Application} w którego skład wchodzą projekty platformy .NET:
\begin{itemize}
	\item \textit{Samson.Web.Application} - projekt w skład którego wchodzą serwisy aplikacyjne realizujące logikę biznesową. Ważnymi składowymi projektu są klasy obsługi komend (ang. \ang{command handler}), których zadaniem jest aktualizacja danych oraz klasy obsługi zapytań (ang. \ang{query handler}), które odpowiadają za odczyt danych z bazy.
	\item \textit{Samson.Web.Application.Api} - projekt, który przy pomocy kontrolerów (ang. \ang{controllers}) obsługuje otrzymane żądania z warstwy klienckiej. Metoda klasy kontrolera tworzy komendę (ang. \ang{command}) lub zapytanie (ang. \ang{query}), które jest następnie przekazywane do mediatora (ang. \ang{mediator}). Mediator rozdziela je do odpowiedniej klasy obsługi komendy lub klasy obsługi zapytań. Takie podejście pozwala na stworzenie skalowalnej architektury podatnej na zmiany. Dzięki takiemu podejściu klasy kontrolerów nie muszą wstrzykiwać zależności w postaci serwisów aplikacyjny lub klas repozytorium (ang. \ang{repository}).
	\item \textit{Samson.Web.Application.Identity} - to projekt odpowiedzialny za tworzenie żetonów JWT oraz sprawdzanie ich poprawności. \textit{Samson.Web.Application.Identity} pełni kluczową rolę w ochronie systemu przed nieautoryzowanym dostępem.
	\item \textit{Samson.Web.Application.Infrastructure} - projekt w skład, którego wchodzą atrybuty, oprogramowanie pośrednie (ang. \ang{middleware}) oraz klasy wykorzystywane w pozostały projektach warstwy serwerowej. Projekt zawiera także klasy globalnej obsługi błędów (ang. \ang{global error handler}), których zadaniem jest przechwytywanie wyjątków (ang. \ang{exception}), które nie zostały wcześniej obsłużone.
	\item \textit{Samson.Web.Application.Models} - zawierający klasy modeli, obiekty transferu danych (ang. \ang{Data transfer object}), struktury danych oraz wyliczenia (ang. \ang{enum}).
	\item \textit{Samson.Web.Application.Persistence} - projekt pełniący kluczową rolę, jeśli chodzi o zapis danych. Projekt zawiera klasy encji (ang. \ang{entity}) oraz klasy repozytoriów. Klasy repozytoriów tworzą warstwę odpowiedzialną za aktualizację danych przy pomocy sterownika \textit{MongoDB .NET Driver}.
	\item \textit{Samson.Web.Application.ReadModels} - w przeciwieństwie do poprzedniego projektu, w skład \textit{Samson.Web.Application.ReadModels} wchodzą klasy odpowiedzialne za odczyt danych z bazy. Zadanie to jest realizowana przy wykorzystaniu klas odczytu modeli (ang. \ang{read model}) w których znajduje się kod realizujący zapytania do bazy przy pomocy wstawek \textit{JavaScript} lub składni \textit{LINQ}.
	\item \textit{Samson.Web.Application.UnitTests} - projekt zawierający kod testów jednostkowych
	\item \textit{Samson.Web.Application.WebHost} - projekt, który jest punktem początkowym aplikacji. W projekcie można znaleźć pliki konfiguracji z rozszerzeniem \textit{JSON}.
\end{itemize}
Istotną częścią warstwy serwerowej jest baza danych, która odpowiada za przechowywanie danych w sposób uporządkowany i trwały. Projekt główny realizuje komunikację z bazą danych przy pomocy sterownika, który pozwala na zintegrowanie technologii \textit{.NET} i bazy \textit{MongoDB}.

\subsubsection{Warstwa prezentacji}
Warstwa prezentacji wysyła żądania do warstwy serwerowej przy pomocy metod \textit{HTTP} i interfejsu \textit{REST API}, który jest punktem łączącym obie warstwy. Podstawowym zadaniem, które realizuje ta warstwa jest graficzna prezentacja funkcjonalności w celu uproszczenia korzystania z systemu.


\section{Organizacja bazy danych}
Baza danych \textit{MongoDB} jest dokumentową, niereleacyjną bazą danych \textit{NoSQL}, więc nie posiada typowej struktury bazy \textit{SQL}. W przeciwieństwie do baz relacyjnych w bazie \textit{MongoDB} często stosuje się denormalizacje struktury w celu poprawienia wydajności odczytu danych. Wadą tego rozwiązania jest potrzeba ręcznego aktualizowania powielonych dokumentów oraz mniejsza wydajność zapisu.

Zaprezentowany schemat bazy prezentuje kolekcje dokumentów, jakie zawiera baza. Na schemacie uwzględnione zostały relacje, które mają charakter poglądowy ze względu na to, że w bazie \textit{MongoDB} nie istnieją prawdziwe relacje pomiędzy kolekcjami.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{../diagramy/schemat_bazy}
	\caption{Poglądowy schemat bazy danych}
	\label{fig:schematbazy}
\end{figure}

\section{Wykorzystane zewnętrzne rozwiązania}
Do projektu zostały wykorzystane nowoczesne platformy programistyczne i biblioteki, które posiadają aktualne wsparcie twórców. Wybrano narzędzia w taki sposób, aby pokryć wymagania funkcjonalne projektu oraz wykorzystać technologie, które są aktualnie wykorzystywane w sposób komercyjny.

Językiem programowania użytym do stworzenia części serwerowej został \textit{C\#} firmy \textit{Microsoft}. Bliskie podobieństwo do języka Java oraz wiele usprawnień względem niego pozwala na tworzenie oprogramowania przy wykorzystaniu technik programowania obiektowego, funkcyjnego czy generycznego \cite{bib:csharp}.

Platformą programistyczną warstwy serwerowej został \textit{.NET 5}, który pozwala na tworzenie aplikacji wieloplatformowych z pomocą języka \textit{C\#}. Dzięki użyciu następcy \textit{.NET Core'a}, aplikacja może zostać uruchomiona zarówno na urządzeniach z systemem \textit{Microsoft} jak i dystrybucjach systemu Linux co pozwala na elastyczność względem wyboru środowiska w którym aplikacja będzie pracować \cite{bib:dotnet5introduction}.

Do stworzenia interfejsu \textit{REST API} została wykorzystana biblioteka \textit{ASP.NET Core}, która pozwala na dodawanie metod HTTP, które będą następnie konsumowane przez warstwę prezentacji. \textit{ASP.NET} Core wspiera wykorzystanie kontenerów wstrzykiwania zależności, obsługę autoryzacji przy pomocy żetonu \textit{JWT} jak i komunikację z wykorzystaniem protokołu HTTPS\cite{bib:asp}.

W celu wykorzystania wzorca projektowego \textit{CQRS} (ang. \ang{command query responsibility separation}) zamiast domyślnego kontenera zależności wykorzystano zewnętrzną bibliotekę \textit{Autofac}, która udostępnia możliwość wstrzykiwania obiektów oznaczonych atrybutami oraz określanie cyklu życia serwisu przy pomocy znaczników\cite{bib:autofactag}.

Jako bazę danych wykorzystano \textit{MongoDB}. \textit{MongoDB} jest dokumentową bazą danych pozwalająca na przechowywanie danych w formacie \textit{JSON}, który jest formatem czytelnym dla człowieka. Baza danych należy do nierelacyjnych baz danych \textit{NoSQL}, której głównymi zaletami są: elastyczny schemat bazy, łatwe skalowanie wszerz oraz możliwość tworzenia zaawansowanych zapytań i raportów\cite{bib:mongodb_guide}. Opcja skalowania bazy wszerz jest istotna w systemach, gdzie trzeba zachować ciągłość działania systemu przy rosnącej bazie użytkowników.

Językiem programowania użytym w części wizualnej aplikacji jest język \textit{TypeScript} zaprojektowany przez firmę \textit{Microsoft}. W odróżnieniu od języka \textit{JavaScript}, \textit{TypeScript} oferuje typowanie w czasie kompilacji, co pozwala na unikanie błędów związanych z niezgodnością typów. Dodanie interfejsów i uogólnień funkcji względem JavaScriptu pozwala na pisanie kodu z wykorzystaniem paradygmatów programowania obiektowego i generycznego\cite{bib:typescript}.

Do stworzenia interfejsu użytkownika została wykorzystana platforma programistyczna Angular, która pozwala na tworzenie aplikacji internetowych przy wykorzystaniu komponentów wielokrotnego użytku. Cechą charakterystyczną platformy jest natywne wykorzystanie języka TypeScript oraz możliwość tworzenia aplikacji typu \textit{SPA}\cite{bib:anuglar}\cite{bib:typescript}.

W celu zminimalizowania czasu potrzebnego na tworzenie komponentów warstwy prezentacji wykorzystano bibliotekę \textit{Angular Material} z gotowym zestawem rozwiązań. Kontrolki zawarte w bibliotece implementują filozofię \textit{Google Material} do tworzenia warstw wizualizacji aplikacji internetowych.

W warstwie prezentacji wykorzystano bibliotekę \textit{NgXS}, która pozwala na wykorzystanie wzorca zarządzania stanem. Rozwiązanie implementuje wzorzec projektowy \textit{Redux}, którego główną zaletą jest ułatwienie odpluskwiania warstwy prezentacji oraz tworzenie stanów, które są deterministyczne.

\section{Przegląd najważniejszych klas}
W trakcie pracy nad systemem zaistniała potrzeba stworzenia klasy pozwalającej na modyfikacje danych w bazie. Głównym założeniem było utworzenie klasy, która będzie wykorzystywać wzorzec repozytorium oraz metodę szablonową. Wzorzec repozytorium miał pomóc w stworzeniu klasy, której głównym zadaniem będzie realizowanie operacji \textit{CRUD}, natomiast wykorzystanie wzorca metody szablonowej miało pomóc w stworzeniu ogólnego algorytmu, który będzie uszczegółowiony w klasach pochodnych. Według tych zasad powstała klasa \textit{MongoRepository} reprezentująca ogólne algorytmy wykorzystywane do operacji \textit{CRUD} niedotyczące żadnej konkretnej kolekcji w bazie danych. Klasy pochodne \textit{MongoRepository}, wykorzystując klasę bazową, tworzyły interfejs do zarządzania dokumentami w konkretnej kolekcji.

W projekcie można znaleźć wiele klas pełniących rolę klas odczytu danych. W takich przypadkach nie stworzono ogólnej klasy bazowej ze względu na niewielkie podobieństwo klas między sobą. Odczyt danych z bazy można osiągnąć na kilka sposobów przy wykorzystaniu sterownika \textit{.NET - MongoDB}. Pierwszy z nich to wykorzystanie wstawek w postaci języka \textit{JavaScript}, co pozwala na pisanie zapytań takich jak w konsoli \textit{MongoDB}. Jedną z takich klas, gdzie wykorzystano możliwości wstawek jest klasa \textit{ExerciseMachineReadModel}. Podstawowym zadaniem tej klasy jest odczyt danych z kolekcji \textit{ExerciseMachineCollection}, gdzie znajdują się informacje o posiadanym sprzęcie do ćwiczeń. Mimo, że \textit{MongoDB} jest nierelacyjną bazą danych, to dzięki wykorzystaniu operatora \textit{lookup} można stworzyć namiastkę złączeń (ang. \ang{join}), które są znane z relacyjnych baz danych. Poniżej zaprezentowana została metoda wykorzystująca operator \textit{lookup} i wcześniej wspominane wstawki kodu.
\begin{figure} [H]
	\centering
	\begin{lstlisting}			
			private IAggregateFluent<BsonDocument> GetGetAllExerciseMachinesQuery()
			{
				var client = new MongoClient(_databaseConfiguration.ConnectionString);
				var database = client.GetDatabase(_databaseConfiguration.DatabaseName);
				
				var collection = database.GetCollection<ExerciseMachineEntity>("ExerciseMachineCollection");
				
				return collection
					.Aggregate()
					.AppendStage<BsonDocument>("{ $lookup: { from: 'GymObjectCollection', localField: 'LocalizationGymObjectId', foreignField: '_id', as: 'LocalizationGymObject'} }")
					.AppendStage<BsonDocument>("{ $unwind: '$LocalizationGymObject' }");
			}
		}
	\end{lstlisting}
	\caption{Metoda odczytu danych z kolekcji \textit{ExerciseMachineCollection} przy wykorzystaniu wstawek \textit{JavaScript}}
	\label{fig:exerciseMachineReadModel}
\end{figure}
Innym sposobem odczytu danych z bazy jest wykorzystanie składni \textit{LINQ}, która pozwala na m.in. tworzenie zapytań. Pomimo duży ograniczeń tego rozwiązania, \textit{LINQ} posiada możliwość tworzenia złączeń. Złączenia te są jednak bardzo ograniczone w porównaniu do baz relacyjnych. Poniżej przedstawiono fragment klasy \textit{GymObjectReadModel}, która odpowiada za odczyt danych z kolekcji \textit{GymObjectCollection}, gdzie znajdują się informacje o obiektach siłowni i pomieszczeniach. Jak widać składnia \textit{LINQ} pozwala na tworzenie zapytań, które przypominają składnie języka \textit{SQL}.
\begin{figure} [H]
	\centering
	\begin{lstlisting}			
    public Task<GymObjectDto> GetById(ObjectId id)
	{
		var client = new MongoClient(_databaseConfiguration.ConnectionString);
		var database = client.GetDatabase(_databaseConfiguration.DatabaseName);
	
		var collection = database.GetCollection<GymObjectEntity>("GymObjectCollection");

		var query = from gymObject in collection.AsQueryable()
			where gymObject.Id == id
			select gymObject;

		return query
			.SingleOrDefaultAsync()
			.ContinueWith(result => _mapper.Map<GymObjectDto>(result.Result));
	}
	\end{lstlisting}
\caption{Metoda odczytu danych z kolekcji \textit{GymObjectCollection} przy wykorzystaniu wstawek składni \textit{LINQ}}
\label{fig:gymObjectReadModel}
\end{figure}

Ostatnim sposobem odczytu danych z bazy jest wykorzystanie metod przygotowanych w bibliotece sterownika \textit{MongoDB .NET Driver}. Posiadają takie same parametry jak te z języka \textit{JavaScript} w którym domyślnie tworzone są zapytania dla bazy \textit{MongoDB}. Z powodu braku niektórych metod względem tych z języka \textit{JavaScript}, programista jest zmuszony do umieszczania wstawek kodu takich jak w klasie \textit{ExerciseMachineReadModel}. W poniższym kodzie zaprezentowano metodę klasy 
\textit{PersonalTrainerReadModel}, której zadaniem jest odczyt z bazy informacji o koncie trenera personalnego.
\begin{figure} [H]
	\centering
	\begin{lstlisting}			
    public Task<PersonalTrainerDto> GetById(ObjectId id)
	{
		var client = new MongoClient(_databaseConfiguration.ConnectionString);
		var database = client.GetDatabase(_databaseConfiguration.DatabaseName);

		var collection = database.GetCollection<PersonalTrainerEntity>("UserCollection");

		var query = collection
			.Aggregate()
			.Match(clientEntity => clientEntity.Id == id)
			.As<PersonalTrainerDto>();

		return query.SingleOrDefaultAsync();
	}
	\end{lstlisting}
	\caption{Metoda odczytu informacji o koncie trenera personalnego przy wykorzystaniu wstawek składni metod sterownika}
	\label{fig:personalTrainerReadModel}
\end{figure}

\section{Przegląd wzorców projektowych}
Poza wcześniej wymienionymi wzorcami metoda szablonowa i repozytorium do stworzenia aplikacji wykorzystano wzorzec \textit{CQRS}. Do implementacji wzorca \textit{CQRS} wykorzystuje się klasy komend i zapytań w celu rozdzielenia zadań dotyczących zapisu i odczytu danych. Komendy są obsługiwane przez klasy obsługi komend, gdzie wywoływane są metody serwisów aplikacyjnych do modyfikacji danych w bazie. Każda klasa obsługi komendy posiada metodę \textit{Handle}, która zostaje wywołana gdy zajdzie potrzeba obsłużenia żądania w postaci obiektu typu \textit{IRequest}. Poniżej przedstawiono kod metody \textit{Handle}, który fragmentem klasy \textit{CreateGymPassTypeCommandHandler}.
\begin{figure} [H]
	\centering
	\begin{lstlisting}			
        public Task<ObjectId> Handle(CreateGymPassTypeCommand request, CancellationToken cancellationToken)
		{
			var dataStructure = _mapper.Map<CreateGymPassTypeCommand, CreateGymPassTypeDataStructure>(request);
			return _service.Create(dataStructure);
		}
	\end{lstlisting}
	\caption{Metoda \textit{Handle} klasy \textit{CreateGymPassTypeCommandHandler}}
	\label{fig:commandHandler}
\end{figure}
Klasy obsługi komend odpowiadają za aktualizację danych w bazie, natomiast klasy obsługi odczytu mają za zadanie odczytać dane z bazy w celu przekazania ich do warstwy prezentacji. Poniżej zaprezentowana została klasa \textit{GymPassTypesQueryHandler}, która odpowiada za odczyt informacji o wszystkich typach karnetów w bazie.
\begin{figure} [H]
	\centering
	\begin{lstlisting}
public class GymPassTypesQueryHandler : IRequestHandler<GetAllGymPassTypesQuery, List<GymPassTypeDto>>
{
	private readonly IGymPassReadModel _readModel;

	public GymPassTypesQueryHandler(IGymPassReadModel readModel)
	{
		_readModel = readModel ?? throw new ArgumentNullException(nameof(readModel));
	}

	public Task<List<GymPassTypeDto>> Handle(GetAllGymPassTypesQuery query, CancellationToken cancellationToken)
	{
		return _readModel.GetAll();
	}
}
	\end{lstlisting}
	\caption{Klasa \textit{GymPassTypesQueryHandler}}
	\label{fig:queryHangler}
\end{figure}
Dopełnieniem \textit{CQRS} jest wzorzec projektowy mediator, którego zadaniem jest przekazywanie obiektów klas odczytu i komend do odpowiednich klas obsługi odczytu i obsługi komend. Takie rozwiązanie pozwala na zwiększenie skalowalności systemu i usunięcie potrzeby wstrzykiwania serwisów aplikacyjnych do klas kontrolerów. Klasa mediatora odpowiada za poprawne dostarczenie obiektu żądania do obiektu klasy obsługi tego żądania. Poniżej przedstawiono fragment kodu klasy kontrolera \textit{EventController}, który odpowiada za udostępnienie metod \textit{CRUD} dotyczących obiektów klasy \textit{Event}. Na fragmencie widać jak wykorzystywany jest mediator do przekazania żądania odczytu informacji o wydarzeniu.
\begin{figure} [H]
	\centering
	\begin{lstlisting}
        public async Task<ActionResult> GetById(string id)
		{
			if (id.IsNullOrEmpty())
			{
				return BadRequest();
			}
			
			var query = _mapper.Map<string, GetEventByIdQuery>(id);
			var queryResult = await _mediator.Send(query);
			var result = _mapper.Map<EventDto, EventViewModel>(queryResult);
			return Ok(result);
		}
	\end{lstlisting}
	\caption{Metoda \textit{GetById} klasy \textit{EventController}}
	\label{fig:mediator}
\end{figure}

\chapter{Weryfikacja i walidacja}
\begin{itemize}
\item sposób testowania w ramach pracy (np. odniesienie do modelu V)
\item organizacja eksperymentów
\item przypadki testowe zakres testowania (pełny/niepełny)
\item wykryte i usunięte błędy
\item opcjonalnie wyniki badań eksperymentalnych
\end{itemize}

\begin{table}
\centering
\caption{Opis tabeli nad nią.}
\label{id:tab:wyniki}
\begin{tabular}{rrrrrrrr}
\toprule
	         &                                     \multicolumn{7}{c}{metoda}                                      \\
	         \cmidrule{2-8}
	         &         &         &        \multicolumn{3}{c}{alg. 3}        & \multicolumn{2}{c}{alg. 4, $\gamma = 2$} \\
	         \cmidrule(r){4-6}\cmidrule(r){7-8}
	$\zeta$ &     alg. 1 &   alg. 2 & $\alpha= 1.5$ & $\alpha= 2$ & $\alpha= 3$ &   $\beta = 0.1$  &   $\beta = -0.1$ \\
\midrule
	       0 &  8.3250 & 1.45305 &       7.5791 &    14.8517 &    20.0028 & 1.16396 &                       1.1365 \\
	       5 &  0.6111 & 2.27126 &       6.9952 &    13.8560 &    18.6064 & 1.18659 &                       1.1630 \\
	      10 & 11.6126 & 2.69218 &       6.2520 &    12.5202 &    16.8278 & 1.23180 &                       1.2045 \\
	      15 &  0.5665 & 2.95046 &       5.7753 &    11.4588 &    15.4837 & 1.25131 &                       1.2614 \\
	      20 & 15.8728 & 3.07225 &       5.3071 &    10.3935 &    13.8738 & 1.25307 &                       1.2217 \\
	      25 &  0.9791 & 3.19034 &       5.4575 &     9.9533 &    13.0721 & 1.27104 &                       1.2640 \\
	      30 &  2.0228 & 3.27474 &       5.7461 &     9.7164 &    12.2637 & 1.33404 &                       1.3209 \\
	      35 & 13.4210 & 3.36086 &       6.6735 &    10.0442 &    12.0270 & 1.35385 &                       1.3059 \\
	      40 & 13.2226 & 3.36420 &       7.7248 &    10.4495 &    12.0379 & 1.34919 &                       1.2768 \\
	      45 & 12.8445 & 3.47436 &       8.5539 &    10.8552 &    12.2773 & 1.42303 &                       1.4362 \\
	      50 & 12.9245 & 3.58228 &       9.2702 &    11.2183 &    12.3990 & 1.40922 &                       1.3724 \\
\bottomrule
\end{tabular}
\end{table}  
 

\chapter{Podsumowanie i wnioski}
\begin{itemize}
\item uzyskane wyniki w świetle postawionych celów i zdefiniowanych wyżej wymagań
\item kierunki ewentualnych danych prac (rozbudowa funkcjonalna …)
\item problemy napotkane w trakcie pracy
\end{itemize}

 
\bibliographystyle{plplain}
\bibliography{bibliografia}
\addcontentsline{toc}{chapter}{Bibliografia}


\begin{appendices}
 

\chapter*{Spis skrótów i symboli}
\addcontentsline{toc}{chapter}{Spis skrótów i symboli}

\begin{itemize}
	\item[CRUD] utwórz, odczytaj, aktualizuj, usuń - (ang. \ang{create, update, read, delete})
\item[MVC] model -- widok -- kontroler (ang. \ang{model--view--controller}) 
\item[SPA] jednostronicowa aplikacja internetowa (ang. \ang{Single page application})
\item[CQRS] (ang. \ang{Command and Query Responsibility Segregation})
\item[TS] (ang. \ang{TypeScript]})
\item[JS] (ang. \ang{JavaScript})
\item[REST] (ang. \ang{Representational state transfer})
\item[API] aplikacyjny interfejs programistyczny (ang. \ang{Application programming interface})
\item[JWT] (ang. \ang{JSON Web Token})
\item[JSON] (ang. \ang{JavaScript Object Notation})
\item[HTTP] (ang. \ang{Hypertext Transfer Protocol})
\item[HTTPS] (ang. \ang{Hypertext Transfer Protocol Secure})
\item[NoSQL] nierelacyjna baza danych
\item[WWW] światowa rozległa sieć komputerowa (ang. \ang{World Wide Web})
\item[DTO] obiekt transferu danych (ang. \ang{Data transfer object})
\item[LINQ] (ang. \ang{Language-Integrated Query})
\item[IDE] zintegrowane środowisko programistyczne (ang. \ang{Integrated development environment})
\item[SQL] (ang. \ang{Structured Query Language})
\end{itemize}


\chapter*{Źródła}
\addcontentsline{toc}{chapter}{Źródła}
\begin{figure}
	\centering
	\begin{lstlisting}
		class descriptor_gaussian : virtual public descriptor
		{
			protected:
			/** core of the gaussian fuzzy set */
			double _mean;
			/** fuzzyfication of the gaussian fuzzy set */
			double _stddev;
			
			public:
			/** @param mean core of the set
			@param stddev standard deviation */
			descriptor_gaussian (double mean, double stddev);
			descriptor_gaussian (const descriptor_gaussian & w);
			virtual ~descriptor_gaussian();
			virtual descriptor * clone () const;
			
			/** The method elaborates membership to the gaussian fuzzy set. */
			virtual double getMembership (double x) const;
			
		};
	\end{lstlisting}
	\caption{Klasa \lstinline|descriptor_gaussian|.}
	\label{fig:pseudokod}
\end{figure}

Klasa abstrakcyjna \textit{MongoRepository} wykorzystywana do wykonywania operacji \textit{CRUD} na kolekcjach bazy \textit{MongoDB}.
\begin{figure}
	\centering
	\begin{lstlisting}
		public abstract class MongoRepository<TModel, TEntity> : IRepository<TModel> where TModel : IAggregate where TEntity : IEntity
		{
			protected readonly IMongoCollection<TEntity> Collection;
			protected readonly IMapper Mapper;
			
			public MongoRepository(IDatabaseConfiguration databaseConfiguration, IMapper mapper)
			{
				Mapper = mapper ?? throw new ArgumentNullException(nameof(mapper));
				
				var client = new MongoClient(databaseConfiguration.ConnectionString);
				var database = client.GetDatabase(databaseConfiguration.DatabaseName);
				
				Collection = database.GetCollection<TEntity>($"{typeof(TModel).Name}Collection");
			}
			
			public MongoRepository(IDatabaseConfiguration databaseConfiguration, IMapper mapper, string collectionName)
			{
				Mapper = mapper ?? throw new ArgumentNullException(nameof(mapper));
				
				var client = new MongoClient(databaseConfiguration.ConnectionString);
				var database = client.GetDatabase(databaseConfiguration.DatabaseName);
				
				Collection = database.GetCollection<TEntity>(collectionName);
			}
			
			public TModel Get(ObjectId id)
			{
				var entity = Collection.Find(model => model.Id == id).FirstOrDefault();
				return Mapper.Map<TEntity, TModel>(entity);
			}
			
			public List<TModel> Get()
			{
				var entities = Collection.Find(model => true).ToList();
				return Mapper.Map<List<TEntity>, List<TModel>>(entities);
			}
			
			public Task<ObjectId> Create(TModel model)
			{
				var entity = Mapper.Map<TModel, TEntity>(model);
				var result = Collection.InsertOneAsync(entity).ContinueWith(_ => model.Id);
				return result;
			}
			
			public Task<ObjectId> Update(ObjectId id, TModel updatedModel)
			{
				var entity = Mapper.Map<TModel, TEntity>(updatedModel);
				return Collection.ReplaceOneAsync(model => model.Id == id, entity).ContinueWith(_ => updatedModel.Id);
			}
			
			public Task<ObjectId> Remove(TModel modelToDelete)
			{
				var entity = Mapper.Map<TModel, TEntity>(modelToDelete);
				return Collection.DeleteOneAsync(model => model.Id == entity.Id).ContinueWith(_ => modelToDelete.Id);
			}
			
			public Task<ObjectId> Remove(ObjectId id)
			=> Collection.DeleteOneAsync(model => model.Id == id).ContinueWith(_ => id);
		}
	\end{lstlisting}
	\caption{Klasa \lstinline|MongoRepository|.}
	\label{fig:mongoRepository}
\end{figure} 

\chapter*{Zawartość dołączonej płyty}
\addcontentsline{toc}{chapter}{Zawartość dołączonej płyty}

Do pracy dołączona jest płyta CD z~następującą zawartością:
\begin{itemize}
\item praca (źródła \LaTeX owe i końcowa wersja w \texttt{pdf}),
\item źródła programu,
\item dane testowe.
\end{itemize}

\listoffigures
\listoftables
	
\end{appendices}


\end{document}


%% Finis coronat opus.
